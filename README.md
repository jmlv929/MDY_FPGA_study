<!--
Author: jmlv
SPDX-License-Identifier: AGPL-3.0-or-later
-->

# 总体

<img src=".\pic\2021-07-26_144015.png" width="1100">

### 1.模块

<img src=".\pic\2021-07-26_144233.png">

<img src=".\pic\2021-07-26_144352.png">

1. 模块端口定义
2. 参数定义
3. I/O说明
4. 内部信号说明
5. 功能定义（描述功能）



### 2.计数器

* **设计特点** ，先将计数器设计好，再以计数器为框架，其余信号与之对齐

> 规则1：计数器逐一考虑三要素，初值，加1条件和结束值
>
> 规则2：计数器初值必须为0
>
> 规则3：使用某一计数值，必须同时满足加1条件
>
> 规则4：结束条件必须同时满足+1条件，且结束值必须是x-1的形式
>
> 规则5：当取某个数时，assign形式必须为：（+1条件）&&（cnt==计数值-1）
>
> 规则6：结束后必须回到0
>
> 规则7：若需要限定范围，使用“>=" 和 ”<=" 两种符号
>
> 规则8：设计步骤是先写计数器的always，然后，再写assign写出+1条件，最后assign写出结束条件
>
> 
>
> 规则9：+1条件必须与计数器严格对齐，其他信号一律向计数器对齐
>
> 规则10：命名必须符合规范，比如add_cnt表示+1条件，end_cnt表示结束条件
>
> 规则11：减1计数器暂时不用

* **设计步骤**

> 1.明确功能
>
> 2.功能波形
>
> 3.计数结构
>
> 4.+1和结束条件
>
> 5.定义特殊点
>
> 6.完整性检查
>
> 7.计数器代码（模板）
>
> 8.功能代码

附：

<img src=".\pic\2021-07-26_150752.png">





### 3.状态机

状态机的设计对系统的高速性、高可靠性、高稳定性起着决定性的作用，跳转顺序乱序的时候用状态机，**一切为了输出信号而服务**

> 规则1：使用四段式状态机（四段代码）
>
> 规则2：四段式状态机第一段写法不变
>
> 规则3：第二段的状态转移条件用信号名来表示
>
> 规则4：用assign的形式将状态转移条件写成xx2xx_start的形式
>
> 规则5：状态转移条件，用assign产生变化条件时，必须加上当前状态
>
> 规则6：状态不变，使用state_n = state_c



**设计步骤**

> 1.明确功能
>
> 2.输出分析
>
> 3.状态合并
>
> 4.状态转移
>
> 5.转移条件
>
> 6.完整性检查
>
> 7.状态机代码（模板）
>
> 8.功能代码





### 4.FIFO

> 规则1：使用show-ahead读模式
>
> 规则2：读、写隔离规则
>
> 规则3：读使能必须判断空状态，并且用组合逻辑产生
>
> 规则4：处理报文时，将指示信号与数据一起存入FIFO
>
> 规则5：读写时钟不同，必须用异步FIFO

FIFO IP核使用：

>1.FIFO宽度
>
>2.FIFO深度（根据读写时间相等，个数不同计算）
>
>3.设置show-ahead模式

**设计步骤**

> 1.确认FIFO架构（通过一个或多个FIFO相互配合）
>
> 2.读状态
>
> 3.读状态启动和结束条件
>
> 4.信息FIFO读清条件
>
> 5.生成FIFO的IP核
>
> 6.其他信号的产生条件
>
> 7.FIFO代码（模板）
>
> 8.其他信号代码（功能代码）





### 5.模块划分核心

**步骤**

>1.利用合适架构进行模块的划分
>
>2.模块端口以及数据流向

**原则**

> 原则1：一个功能一个模块
>
> 原则2：相同架构一个模块

**信号规范**：

> clk:时钟
>
> rst_n:复位信号
>
> en：使能信号
>
> vld：数据有效信号
>
> data：数据总线
>
> err：报文错误
>
> sop：报文起始信号
>
> eop：报文结束信号
>
> rdy：模块准备好信号

**划分模块的重要性**：

> 1.模块各司其职
>
> 2.方便调试





### 6.模块划分常用架构

> 1.直接交互架构(模块A直接发送数据，不需要模块B反馈,一般用于下游模块处理速率高于上游模块速率)
>
> <img src=".\pic\2021-08-04_100832.png">
>
> 2.无缓存rdy交互架构（一般用于上游模块速率高，有缓存，下游模块速率低）
>
> <img src=".\pic\2021-08-04_101008.png">
>
> 3.有缓存rdy交互架构（模块A和B按各自时钟读写FIFO，解决速率不匹配，一般用于上下游模块都有缓存情况，rdy信号可使时序不那么严格）
>
> <img src=".\pic\2021-08-04_101224.png">
>
> 4.请求应答交互架构(一般应用于上游模块等待响应后才能连续发送一段数据的情况)
>
> <img src=".\pic\2021-08-04_101518.png">
>
> 5.外设交互架构(分为不需配置以及需配置的架构)
>
> <img src=".\pic\2021-08-04_101934.png">
>
> <img src =".\pic\2021-08-04_102008.png">



